// Alpha Vantage API key
const API_KEY = '1Q997OJZEAUKB8KL';

// Fetch the latest SPX value
async function fetchLatestSPX() {
    const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=^GSPC&apikey=${API_KEY}`;
    const response = await fetch(url);
    const data = await response.json();

    // Debugging: Log the API response
    console.log('API Response:', data);

    if (data.Note) {
        throw new Error('API rate limit exceeded. Try again later.');
    }
    if (data['Global Quote'] && data['Global Quote']['05. price']) {
        return parseFloat(data['Global Quote']['05. price']);
    } else {
        throw new Error('Latest SPX data not found.');
    }
}

// Calculate and display the percentage
async function calculatePercentage() {
    const HIGH_2000 = 1552.87; // SPX high on March 24, 2000
    const CLOSE_2023 = 4607.35; // SPX close on December 7, 2023

    try {
        // Fetch the latest SPX value
        const SPX = await fetchLatestSPX();
        const USM2 = 1.5; // Placeholder for U.S. Money Supply

        // Perform the calculation
        const calculatedValue = (SPX / USM2) * 10000000000;
        const percentage = ((calculatedValue - CLOSE_2023) / (HIGH_2000 - CLOSE_2023)) * 100;

        // Display the result
        document.getElementById('percentage').innerText = percentage.toFixed(2) + '%';
    } catch (error) {
        console.error('Error calculating data:', error);
        document.getElementById('percentage').innerText = 'Error';
    }
}

// Run the calculation
calculatePercentage();
